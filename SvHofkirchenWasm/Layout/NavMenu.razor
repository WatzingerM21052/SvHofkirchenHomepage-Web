@using SvHofkirchenWasm.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="d-flex flex-column h-100">
    <div class="p-4 text-center border-bottom border-secondary">
        <a href="" class="d-block text-decoration-none nav-logo">
            <img src="Pictures/SVHofkirchenLogoWhite.svg" alt="SV Hofkirchen" class="img-fluid mb-2"
                style="max-height: 80px;" />
            <h6 class="text-white mb-0 fw-bold text-uppercase letter-spacing-1">Sektion Schach</h6>
            <small class="text-white-50">Jugend Portal</small>
        </a>

    <style>
        /* Entfernt den Standard-Focus-Ring vom Logo-Link */
        .nav-logo:focus {
            outline: none;
        }
    
        /* Optional: Besserer Focus-Style für Keyboard-Navigation (Accessibility) */
        .nav-logo:focus-visible {
            outline: 2px solid rgba(255, 255, 255, 0.5);
            outline-offset: 2px;
            border-radius: 4px;
        }
    </style>
    </div>

    <nav class="flex-grow-1 p-3 nav-scrollable">
        <div class="nav flex-column gap-2">
            @if (AuthService.IsAuthenticated && AuthService.CurrentRole != "Besucher")
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                        <i class="bi bi-speedometer2 me-2"></i> Dashboard
                    </NavLink>
                </div>
            }

            @if (AuthService.IsAuthenticated && (AuthService.CurrentRole == "Admin" || AuthService.CurrentRole == "Trainer"))
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="attendance">
                        <i class="bi bi-calendar-check me-2"></i> Anwesenheit
                    </NavLink>
                </div>
            }

            @if (AuthService.IsAuthenticated && (AuthService.CurrentRole == "Admin" || AuthService.CurrentRole == "Trainer"))
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="youth-list">
                        <i class="bi bi-people me-2"></i> Spieler & Daten
                    </NavLink>
                </div>
            }

            @if (AuthService.IsAuthenticated && AuthService.CurrentRole != "Besucher")
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="statistics">
                        <i class="bi bi-graph-up me-2"></i> Statistik
                    </NavLink>
                </div>
            }

            @if (AuthService.IsAuthenticated && AuthService.CurrentRole == "Besucher")
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="visitor">
                        <i class="bi bi-info-circle me-2"></i> Trainings-Info
                    </NavLink>
                </div>
            }
        </div>
    </nav>

    <div class="p-3 border-top border-secondary mt-auto">
        <div class="nav flex-column">
            @if (AuthService.IsAuthenticated && AuthService.CurrentRole == "Admin")
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="settings">
                        <i class="bi bi-gear me-2"></i> Einstellungen
                    </NavLink>
                </div>
            }

            @if (AuthService.IsAuthenticated && AuthService.CurrentRole == "Admin")
            {
                <div class="nav-item">
                    <NavLink class="nav-link" href="admin/users">
                        <i class="bi bi-shield-lock me-2"></i> Benutzerverwaltung
                    </NavLink>
                </div>
            }
            
            <div class="nav-item mt-2">
                 @if (AuthService.IsAuthenticated)
                 {
                     <NavLink class="nav-link text-warning" href="" @onclick="Logout">
                        <i class="bi bi-box-arrow-right me-2"></i> Abmelden
                     </NavLink>
                 }
                 else 
                 {
                     <NavLink class="nav-link text-warning" href="login">
                        <i class="bi bi-box-arrow-in-right me-2"></i> Anmelden
                     </NavLink>
                 }
            </div>
        </div>
        <div class="text-center mt-3 text-white-50 small">
            &copy; @DateTime.Now.Year SV Hofkirchen
        </div>
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        AuthService.OnAuthStateChanged += StateHasChanged;
    }

    public void Dispose()
    {
        AuthService.OnAuthStateChanged -= StateHasChanged;
    }
    
    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        // Erzwingt einen kompletten Reload der Seite -> Daten werden aus dem Speicher gelöscht
        Navigation.NavigateTo("/", forceLoad: true);
    }
}