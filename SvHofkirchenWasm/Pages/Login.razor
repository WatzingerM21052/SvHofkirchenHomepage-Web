@page "/login"
@layout Layout.MainLayout
@using SvHofkirchenWasm.Services
@inject AuthService AuthService
@inject NavigationService NavService

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg border-0 rounded-3">
                <div class="card-header bg-primary text-white text-center py-3">
                    <h4 class="mb-0 fw-bold">Anmeldung</h4>
                </div>
                <div class="card-body p-4">
                    @if (!string.IsNullOrEmpty(errorMessage))
                    {
                        <div class="alert alert-danger text-center animate-shake" role="alert">
                            <i class="bi bi-exclamation-circle-fill me-2"></i>@errorMessage
                        </div>
                    }

                    <div class="mb-3">
                        <label class="form-label text-muted small fw-bold text-uppercase">Benutzername</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="bi bi-person"></i></span>
                            <input type="text" class="form-control" @bind="username" placeholder="Benutzername" @onkeyup="HandleEnter" />
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-muted small fw-bold text-uppercase">Passwort</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light"><i class="bi bi-lock"></i></span>
                            <input type="password" class="form-control" @bind="password" placeholder="Passwort" @onkeyup="HandleEnter" />
                        </div>
                    </div>

                    <button class="btn btn-primary w-100 py-2 fw-bold shadow-sm" @onclick="ExecuteLogin" disabled="@isLoading">
                        @if (isLoading)
                        {
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            <span>Anmelden...</span>
                        }
                        else
                        {
                            <span><i class="bi bi-box-arrow-in-right me-2"></i>Anmelden</span>
                        }
                    </button>
                </div>
                <div class="card-footer bg-light text-center py-3">
                    <small class="text-muted">SV Hofkirchen &copy; @DateTime.Now.Year</small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .animate-shake { animation: shake 0.5s; }
    @@keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        50% { transform: translateX(5px); }
        75% { transform: translateX(-5px); }
        100% { transform: translateX(0); }
    }
</style>

@code {
    private string username = "";
    private string password = "";
    private string errorMessage = "";
    private bool isLoading = false;

    private async Task ExecuteLogin()
    {
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            errorMessage = "Bitte Benutzername und Passwort eingeben.";
            return;
        }

        isLoading = true;
        errorMessage = "";
        
        // Echter API Call
        var result = await AuthService.LoginAsync(username, password);
        
        isLoading = false;

        if (result.Success)
        {
            NavService.NavigateToHome(forceLoad: true);
        }
        else
        {
            errorMessage = result.Message ?? "Login fehlgeschlagen.";
        }
    }

    private async Task HandleEnter(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await ExecuteLogin();
        }
    }
}