@page "/admin"
@inject DataService DataService
@inject IJSRuntime JSRuntime

<h1>Admin Dashboard</h1>

<div class="alert alert-warning">
    <strong>Achtung:</strong> GitHub Pages ist statisch. Änderungen hier werden erst im Browser gespeichert. 
    Um sie permanent für alle sichtbar zu machen, musst du die Datenbank herunterladen und ins Git-Repo pushen!
</div>

<div class="card p-4 mb-4">
    <h4>Aktionen</h4>
    <div class="d-flex gap-3">
        <button class="btn btn-success" @onclick="SaveLocally">
            <i class="bi bi-save"></i> 1. Speichern (Browser)
        </button>
        <button class="btn btn-primary" @onclick="DownloadDb">
            <i class="bi bi-cloud-download"></i> 2. Datenbank Download (.json)
        </button>
    </div>
</div>

<h3>Schnell-Edit (Beispiel News)</h3>
@if (DataService.IsInitialized)
{
    <div class="mb-3">
        <label>Neuer News Titel:</label>
        <input class="form-control" @bind="newTitle" />
        <label>Inhalt:</label>
        <textarea class="form-control" @bind="newContent"></textarea>
        <button class="btn btn-secondary mt-2" @onclick="AddNews">News hinzufügen</button>
    </div>

    <p>Aktuelle News Einträge: @DataService.Data.Reports.Count</p>
}

@code {
    private string newTitle = "";
    private string newContent = "";

    protected override async Task OnInitializedAsync()
    {
        await DataService.InitializeAsync();
    }

    private void AddNews()
    {
        DataService.Data.Reports.Add(new ReportDto 
        { 
            ReportId = DataService.Data.Reports.Count + 1,
            Title = newTitle,
            Content = newContent,
            Date = DateTime.Now
        });
        newTitle = "";
        newContent = "";
    }

    private async Task SaveLocally()
    {
        await DataService.SaveChangesAsync();
        await JSRuntime.InvokeVoidAsync("alert", "Erfolgreich im Browser gespeichert!");
    }

    private async Task DownloadDb()
    {
        await DataService.DownloadDatabaseAsync();
    }
}