@page "/settings"
@inject YouthService Service

<div class="container p-4">
    <h2 class="fw-bold text-primary mb-4">Einstellungen & Datenbank</h2>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex p-3 mb-3">
                        <i class="bi bi-cloud-download fs-1"></i>
                    </div>
                    <h4>Datenbank Speichern</h4>
                    <p class="text-muted">Lade den aktuellen Stand als JSON-Datei herunter. <br>Wichtig für Backups!</p>
                    <button class="btn btn-primary px-4 rounded-pill" @onclick="Service.DownloadDataAsync">
                        <i class="bi bi-download me-2"></i> Download (.json)
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="bg-warning bg-opacity-10 text-warning rounded-circle d-inline-flex p-3 mb-3">
                        <i class="bi bi-cloud-upload fs-1"></i>
                    </div>
                    <h4>Datenbank Importieren</h4>
                    <p class="text-muted">Stelle ein Backup wieder her oder lade eine neue Liste hoch.<br><span class="text-danger">Überschreibt aktuelle Daten!</span></p>
                    
                    <div class="d-inline-block position-relative overflow-hidden">
                        <InputFile OnChange="LoadFiles" class="position-absolute top-0 start-0 opacity-0 w-100 h-100" style="cursor: pointer;" />
                        <button class="btn btn-outline-dark px-4 rounded-pill">
                            <i class="bi bi-folder2-open me-2"></i> Datei wählen...
                        </button>
                    </div>
                    @if(!string.IsNullOrEmpty(statusMessage))
                    {
                        <div class="mt-2 text-success small fw-bold">@statusMessage</div>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="alert alert-info mt-4 border-0 shadow-sm d-flex align-items-center">
        <i class="bi bi-info-circle-fill fs-4 me-3"></i>
        <div>
            <strong>Info:</strong> Die Daten werden automatisch bei jeder Änderung im Browser (LocalStorage) gespeichert. 
            Der Download ist nur notwendig, um die Daten auf ein anderes Gerät zu übertragen oder dauerhaft zu sichern.
        </div>
    </div>
</div>

@code {
    private string statusMessage = "";

    protected override async Task OnInitializedAsync()
    {
        await Service.InitializeAsync();
    }

    private async Task LoadFiles(InputFileChangeEventArgs e)
    {
        statusMessage = "Lade...";
        try
        {
            await Service.ImportDataAsync(e.File);
            statusMessage = "Import erfolgreich!";
        }
        catch
        {
            statusMessage = "Fehler beim Import!";
        }
    }
}