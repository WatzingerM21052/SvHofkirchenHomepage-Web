@page "/users"
@using SvHofkirchenHomepage.Models
@using SvHofkirchenHomepage.Services
@inject DataService DataService
@inject AuthenticationService AuthService
@inject NavigationManager NavManager

<PageTitle>Benutzerverwaltung</PageTitle>

@if (!IsAuthorized) 
{ 
    <p>Nicht autorisiert.</p> 
}
else
{
    <RadzenText TextStyle="TextStyle.H3">ðŸ‘¥ Benutzer</RadzenText>
    
    <RadzenDataGrid Data="@UserList" TItem="UserDto" AllowSorting="true" AllowPaging="true" PageSize="10">
        <Columns>
            <RadzenDataGridColumn TItem="UserDto" Property="UserId" Title="ID" Width="50px" />
            <RadzenDataGridColumn TItem="UserDto" Property="UserName" Title="Benutzername" />
            <RadzenDataGridColumn TItem="UserDto" Property="UserEmail" Title="Email" />
            <RadzenDataGridColumn TItem="UserDto" Property="PermissionLevel" Title="Level" Width="80px" />
            <RadzenDataGridColumn TItem="UserDto" Title="Mitglied-ID" Width="100px">
                <Template Context="user">
                    @if(user.MemberId.HasValue) { <span>@user.MemberId</span> } else { <span style="color:#ccc">-</span> }
                </Template>
            </RadzenDataGridColumn>
        </Columns>
    </RadzenDataGrid>
}

@code {
    private bool IsAuthorized = false;
    
    // FIX: Umbenannt von "Users" zu "UserList", da die Klasse schon "Users" heiÃŸt
    private List<UserDto> UserList = new();

    protected override async Task OnInitializedAsync()
    {
        IsAuthorized = await AuthService.IsAuthenticated();
        if (!IsAuthorized) { NavManager.NavigateTo("/login"); return; }

        var data = await DataService.GetDataAsync();
        UserList = data.User ?? new();
    }
}