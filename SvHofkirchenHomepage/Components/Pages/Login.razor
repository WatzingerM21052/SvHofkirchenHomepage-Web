@page "/login"
@using SvHofkirchenHomepage.Services
@using SvHofkirchenHomepage.Models
@using Radzen
@using Radzen.Blazor
@inject AuthenticationService AuthService
@inject NavigationManager NavigationManager
@inject NotificationService NotificationService

<PageTitle>Login - SV Hofkirchen</PageTitle>

<div style="display: flex; justify-content: center; align-items: center; height: 80vh;">
    <RadzenCard Style="width: 400px; padding: 30px;">
        <RadzenText TextStyle="TextStyle.H4" Style="text-align: center; margin-bottom: 20px;">Admin Login</RadzenText>
        
        <RadzenStack Gap="1rem">
            <RadzenTextBox Placeholder="Benutzername" @bind-Value="Username" Style="width: 100%" />
            <RadzenPassword Placeholder="Passwort" @bind-Value="Password" Style="width: 100%" @onkeydown="@Enter" />
            
            <RadzenButton Text="Anmelden" Click="DoLogin" ButtonStyle="ButtonStyle.Primary" Style="width: 100%" IsBusy="IsBusy" />
        </RadzenStack>

        <RadzenText TextStyle="TextStyle.Caption" Style="margin-top: 15px; text-align: center; color: gray;">
            (Demo Mode: admin / admin)
        </RadzenText>
    </RadzenCard>
</div>

@code {
    private string Username = "";
    private string Password = "";
    private bool IsBusy = false;

    private async Task DoLogin()
    {
        IsBusy = true;
        // Simulierter Login-Check
        var success = await AuthService.Login(Username, Password);
        IsBusy = false;

        if (success)
        {
            NotificationService.Notify(NotificationSeverity.Success, "Erfolg", "Willkommen zurück!");
            NavigationManager.NavigateTo("/admin");
        }
        else
        {
            NotificationService.Notify(NotificationSeverity.Error, "Fehler", "Ungültige Zugangsdaten.");
        }
    }

    private async Task Enter(KeyboardEventArgs e)
    {
        if (e.Code == "Enter" || e.Code == "NumpadEnter")
        {
            await DoLogin();
        }
    }
}