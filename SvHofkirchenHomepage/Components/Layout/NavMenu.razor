@using Radzen
@using Radzen.Blazor
@using SvHofkirchenHomepage.Services
@inject AuthenticationService AuthService
@inject NavigationManager NavigationManager

<RadzenPanelMenu Style="height: 100%">
    <RadzenPanelMenuItem Text="Startseite" Icon="home" Path="" />
    <RadzenPanelMenuItem Text="Berichte" Icon="article" Path="reports" />
    <RadzenPanelMenuItem Text="Termine" Icon="event" Path="events" />
    <RadzenPanelMenuItem Text="Jugend" Icon="school" Path="youth" />
    <RadzenPanelMenuItem Text="Mitglieder" Icon="groups" Path="members" />
    <RadzenPanelMenuItem Text="Galerie" Icon="photo_library" Path="gallery" />
    
    <RadzenPanelMenuItem Text="Verein" Icon="info">
        <RadzenPanelMenuItem Text="Über uns" Icon="description" Path="about" />
        <RadzenPanelMenuItem Text="Kontakt" Icon="email" Path="contact" />
        <RadzenPanelMenuItem Text="Impressum" Icon="policy" Path="impressum" />
    </RadzenPanelMenuItem>

    <RadzenPanelMenuItem Text="Admin" Icon="admin_panel_settings" Expanded="true">
        @if (IsLoggedIn)
        {
            <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Path="admin" />
            <RadzenPanelMenuItem Text="Benutzer" Icon="manage_accounts" Path="users" />
            <RadzenPanelMenuItem Text="Logout" Icon="logout" Click="Logout" />
        }
        else
        {
            <RadzenPanelMenuItem Text="Login" Icon="login" Path="login" />
        }
    </RadzenPanelMenuItem>
</RadzenPanelMenu>

@code {
    private bool IsLoggedIn = false;

    protected override async Task OnInitializedAsync()
    {
        // Abonnieren, damit sich das Menü ändert, wenn man sich einloggt
        AuthService.OnChange += StateHasChanged;
        IsLoggedIn = await AuthService.IsAuthenticated();
    }

    public void Dispose()
    {
        AuthService.OnChange -= StateHasChanged;
    }

    private async Task Logout()
    {
        await AuthService.Logout();
        NavigationManager.NavigateTo("/");
    }
}